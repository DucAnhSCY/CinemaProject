<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - CinemaBooking</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Cinema Theme CSS -->
    <link th:href="@{/css/cinema-theme.css}" rel="stylesheet">
    <style>
        .progress-oauth { width: 60%; }
        .progress-bookings { width: 45%; }
    </style>
</head>
<body class="bg-dark">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold" th:href="@{/}">
                <i class="fas fa-film me-2"></i>CinemaBooking Admin
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" th:href="@{/admin}">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/admin/movies}">
                            <i class="fas fa-film me-1"></i>Movie Management
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/admin/screenings}">
                            <i class="fas fa-calendar-alt me-1"></i>Screenings
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/admin/bookings}">
                            <i class="fas fa-ticket-alt me-1"></i>Booking Management
                        </a>
                    </li>
                    <!-- Admin Only -->
                    <li class="nav-item" sec:authorize="hasRole('ADMIN')">
                        <a class="nav-link" th:href="@{/admin/users}">
                            <i class="fas fa-users me-1"></i>User Management
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user me-1"></i>
                            <span sec:authentication="name">Admin</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" th:href="@{/}">
                                <i class="fas fa-home me-2"></i>Go to Homepage
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/auth/logout}">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h1 class="h3 text-muted mb-0">
                                <i class="fas fa-tachometer-alt me-3 text-primary"></i>
                                <span sec:authorize="hasRole('ADMIN')">Admin Dashboard</span>
                                <span sec:authorize="hasRole('THEATER_MANAGER') and !hasRole('ADMIN')">Theater Manager Dashboard</span>
                            </h1>
                            <p class="text-muted mt-2">CinemaBooking System Overview</p>
                            <small class="text-info">
                                <i class="fas fa-user me-1"></i>
                                Role: 
                                <span sec:authorize="hasRole('ADMIN')" class="badge bg-danger">Administrator</span>
                                <span sec:authorize="hasRole('THEATER_MANAGER') and !hasRole('ADMIN')" class="badge bg-warning">Theater Manager</span>
                            </small>
                        </div>
                        <div>
                            <span class="badge bg-success">
                                <i class="fas fa-circle me-1"></i>System Online
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="row g-4 mb-5">
                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title text-muted mb-2">Total Movies</h6>
                                    <h3 class="text-muted mb-0" id="totalMovies" th:text="${totalMovies ?: '-'}">-</h3>
                                    <small class="text-success">
                                        <i class="fas fa-arrow-up me-1"></i>+5% from last month
                                    </small>
                                </div>
                                <div class="text-primary">
                                    <i class="fas fa-film fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title text-muted mb-2">Auditoriums</h6>
                                    <h3 class="text-muted mb-0" id="totalAuditoriums" th:text="${cinemaStats != null ? cinemaStats.totalAuditoriums : '4'}">4</h3>
                                    <small class="text-info">
                                        <i class="fas fa-info me-1"></i>50 seats each
                                    </small>
                                </div>
                                <div class="text-success">
                                    <i class="fas fa-door-open fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title text-muted mb-2">Today's Bookings</h6>
                                    <h3 class="text-muted mb-0" id="todayBookings" th:text="${totalBookings ?: '-'}">-</h3>
                                    <small class="text-warning">
                                        <i class="fas fa-minus me-1"></i>No change
                                    </small>
                                </div>
                                <div class="text-warning">
                                    <i class="fas fa-ticket-alt fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title text-muted mb-2">Total Users</h6>
                                    <h3 class="text-muted mb-0" id="totalUsers" th:text="${totalUsers ?: '-'}">-</h3>
                                    <small class="text-success">
                                        <i class="fas fa-arrow-up me-1"></i>+12% from last month
                                    </small>
                                </div>
                                <div class="text-info">
                                    <i class="fas fa-users fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cinema Overview -->
            <div class="row mb-5" th:if="${cinemaStats != null}">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title text-muted mb-0">
                                <i class="fas fa-building me-2"></i>Cinema Overview
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <h3 class="text-primary" th:text="${cinemaStats.name}">Cinema Paradise</h3>
                                    <p class="text-muted">Cinema Name</p>
                                </div>
                                <div class="col-md-3">
                                    <h3 class="text-success" th:text="${cinemaStats.totalAuditoriums}">4</h3>
                                    <p class="text-muted">Auditoriums</p>
                                </div>
                                <div class="col-md-3">
                                    <h3 class="text-warning" th:text="${cinemaStats.totalSeats}">200</h3>
                                    <p class="text-muted">Total Seats</p>
                                </div>
                                <div class="col-md-3">
                                    <h3 class="text-info">3</h3>
                                    <p class="text-muted">Seat Types</p>
                                </div>
                            </div>
                            <div class="mt-3 text-center">
                                <span class="badge bg-success me-2">Standard: 28 seats/auditorium</span>
                                <span class="badge bg-warning me-2">VIP: 16 seats/auditorium</span>
                                <span class="badge bg-danger">Couple: 6 seats/auditorium</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="row mb-5">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title text-muted mb-0">
                                <i class="fas fa-bolt me-2"></i>Quick Actions
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-lg-2 col-md-4 col-sm-6">
                                    <a th:href="@{/admin/tmdb}" class="btn btn-outline-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                        <i class="fas fa-download fa-2x mb-2"></i>
                                        <span>Import TMDB Movies</span>
                                    </a>
                                </div>
                                <div class="col-lg-2 col-md-4 col-sm-6">
                                    <a th:href="@{/admin/movies/new}" class="btn btn-outline-success w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                        <i class="fas fa-plus fa-2x mb-2"></i>
                                        <span>Add New Movie</span>
                                    </a>
                                </div>
                                <div class="col-lg-2 col-md-4 col-sm-6">
                                    <a th:href="@{/admin/theaters}" class="btn btn-outline-info w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                        <i class="fas fa-building fa-2x mb-2"></i>
                                        <span>Manage Theater</span>
                                    </a>
                                </div>
                                <div class="col-lg-2 col-md-4 col-sm-6">
                                    <a th:href="@{/admin/screenings}" class="btn btn-outline-success w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                        <i class="fas fa-calendar-alt fa-2x mb-2"></i>
                                        <span>Screening Schedule</span>
                                    </a>
                                </div>
                                <div class="col-lg-2 col-md-4 col-sm-6">
                                    <a th:href="@{/admin/users}" class="btn btn-outline-warning w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                        <i class="fas fa-user-cog fa-2x mb-2"></i>
                                        <span>User Management</span>
                                    </a>
                                </div>
                                <div class="col-lg-2 col-md-4 col-sm-6">
                                    <a th:href="@{/admin/bookings}" class="btn btn-outline-secondary w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                        <i class="fas fa-list fa-2x mb-2"></i>
                                        <span>View Bookings</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title text-muted mb-0">
                                <i class="fas fa-clock me-2"></i>Recent Activities
                            </h5>
                            <button class="btn btn-outline-secondary btn-sm" onclick="loadRecentActivities()">
                                <i class="fas fa-refresh me-1"></i>Refresh
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="recentActivities">
                                <!-- Activities will be loaded here -->
                                <div class="d-flex align-items-center mb-3">
                                    <div class="bg-primary rounded-circle p-2 me-3">
                                        <i class="fas fa-user text-white"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">New user registered</h6>
                                        <small class="text-muted">john.doe@example.com - 5 minutes ago</small>
                                    </div>
                                </div>

                                <div class="d-flex align-items-center mb-3">
                                    <div class="bg-success rounded-circle p-2 me-3">
                                        <i class="fas fa-ticket-alt text-white"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">Successful booking</h6>
                                        <small class="text-muted">Movie ticket "Avengers: Endgame" - 10 minutes ago</small>
                                    </div>
                                </div>

                                <div class="d-flex align-items-center mb-3">
                                    <div class="bg-info rounded-circle p-2 me-3">
                                        <i class="fas fa-film text-white"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">New movie added</h6>
                                        <small class="text-muted">"Spider-Man: No Way Home" - 1 hour ago</small>
                                    </div>
                                </div>

                                <div class="d-flex align-items-center">
                                    <div class="bg-warning rounded-circle p-2 me-3">
                                        <i class="fas fa-cog text-white"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">System update</h6>
                                        <small class="text-muted">OAuth2 authentication enabled - 2 hours ago</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title text-muted mb-0">
                                <i class="fas fa-chart-pie me-2"></i>Quick Statistics
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-4">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>TMDB Movies</span>
                                    <span class="badge bg-primary" id="tmdbMoviesCount">-</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar bg-primary w-75"></div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>OAuth2 Users</span>
                                    <span class="badge bg-success" id="oauthUsersCount">-</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar bg-success progress-oauth"></div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Today's Bookings</span>
                                    <span class="badge bg-warning" id="todayBookingsCount">-</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar bg-warning progress-bookings"></div>
                                </div>
                            </div>

                            <div class="text-center">
                                <a th:href="@{/admin/reports}" class="btn btn-outline-primary btn-sm">
                                    View detailed reports <i class="fas fa-arrow-right ms-1"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
        });

        // Load dashboard statistics
        async function loadDashboardData() {
            try {
                // Load movies count
                const moviesResponse = await fetch('/api/movies');
                if (moviesResponse.ok) {
                    const movies = await moviesResponse.json();
                    document.getElementById('totalMovies').textContent = movies.length;
                    
                    // Count TMDB movies
                    const tmdbMovies = movies.filter(m => m.tmdbId);
                    document.getElementById('tmdbMoviesCount').textContent = tmdbMovies.length;
                }

                // Mock data for other statistics (replace with real API calls)
                document.getElementById('totalUsers').textContent = '1,234';
                document.getElementById('todayBookings').textContent = '45';
                document.getElementById('monthlyRevenue').textContent = '$12,345';
                document.getElementById('oauthUsersCount').textContent = '789';
                document.getElementById('todayBookingsCount').textContent = '45';

            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Load recent activities
        function loadRecentActivities() {
            // Mock implementation - replace with real API call
            console.log('Loading recent activities...');
        }

        // Auto-refresh dashboard every 5 minutes
        setInterval(loadDashboardData, 5 * 60 * 1000);
    </script>
</body>
</html>
